form#hiddenDeleteForm method="post" style="display:none;"
  input type="hidden" name="_method" value="delete"
  input type="hidden" name="authenticity_token" value="#{form_authenticity_token}"

.container.col
  h1.space-bot-xl Reports
  i.fa-solid.fa-file-lines.space-bot-xl style="font-size: 7rem;"
  = link_to "reports/new", class: 'add-button' do
    i.fa-solid.fa-file-circle-plus
    |  Generate Report
  .space-bot-s
  table.dark-table 
    thead
      tr
        th Report ID
        th Report Type
        th Staff ID
        th Generated By
        th Date Created
        th Action
    tbody
      
  /## DASHBOARD BUTTON ##
  .space-bot-m
  = link_to '/', class: 'dashboard-button' do
    i.fa-solid.fa-house
    |  Back to Dashboard

/## MODAL SECTION ##
#deleteModal.modal
  .modal-content
    h4.space-bot-xl style="color: black; font-size: 1.2rem" Are you sure you want to delete this Record?
    .modal-actions
      = link_to '#', id: 'confirmDelete', class: 'delete-button' do
        i.fa-solid.fa-thumbs-up
        |  Yes, Delete
      a.btn.modal-close
        i.fa-solid.fa-thumbs-down
        |  No, Cancel

style
  |
    .dark-table {
      width: 1000px; /* or any specific width */
    }


/###############################################################################
/## JAVASCRIPT SECTION ##
/########################
javascript:
    $(document).ready(function () {
        // Use event delegation for dynamically added rows
        $('tbody').on('click', '.open-modal', function (e) {
            e.preventDefault();
            const deleteUrl = $(this).data('url');
            $('#hiddenDeleteForm').attr('action', deleteUrl);
            $('#deleteModal').show();
        });
        $('#confirmDelete').on('click', function (e) {
            e.preventDefault();
            $('#hiddenDeleteForm').submit();
        });

        $('.modal-close').on('click', function () {
            $('#deleteModal').hide();
        });

        let start = 0;
        const limit = 50;
        let isLoading = false;

        function loadReports(start, limit) {
            $.getJSON(`/reports?start=${start}&limit=${limit}`, function (data) {
                if (data.reports.length === 0) {
                    isLoading = false;
                    return;
                }

                data.reports.forEach(function (report) {
                    const row = `
                      <tr>
                          <td>${report.id}</td>
                          <td>${report.report_type}</td>
                          <td>${report.management_staffs_id}</td>
                          <td>${report.full_name}</td>
                          <td>${new Date(report.created_at).toLocaleDateString()}</td>
                          <td>
                              <a href="reports/${report.id}" class="view-button"><i class="fa-regular fa-id-card"></i> View</a>
                              <a href="#" class="open-modal delete-button" data-url="reports/${report.id}"><i class="fa-solid fa-trash"></i> Delete</a>
                          </td>
                      </tr>
                  `;
                    $('tbody').append(row);
                });

                isLoading = false;
            });
        }

        loadReports(start, limit);

        $(window).on('scroll', function () {
            if (isLoading) {
                return;
            }

            const scrollTop = $(window).scrollTop();
            const docHeight = $(document).height();
            const winHeight = $(window).height();

            if (scrollTop + winHeight >= docHeight) {
                isLoading = true;
                start += limit;
                loadReports(start, limit);
            }
        });
    });